---
title: "testing"
author: "Asad Tariq"
date: "`r Sys.Date()`"
output: pdf_document
---

## Loading Libraries

```{r}
library(dplyr)
library(tidyverse)
library(caret)
library(tm)
```

## Reading the Dataset

```{r}
df <- read_csv("../data/fake_job_postings.csv")
head(df)
```


## Extracting Required Columns

```{r}
df_sub <- select(
  df, title, location, department, company_profile, description,
  requirements, benefits, telecommuting, has_company_logo, has_questions,
  employment_type, required_experience, required_education, sub_industry,
  industry, fraudulent
  )

head(df_sub)
```

## Removing the NAs

```{r}
df_sub$benefits <- ifelse(is.na(df_sub$benefits), 0, 1)
df_sub$location[is.na(df_sub$location)] <- "Not-Specified"
df_sub$department[is.na(df_sub$department)] <- "Not-Specified"
df_sub$employment_type[is.na(df_sub$employment_type)] <- "Not-Specified"
df_sub$required_experience[is.na(df_sub$required_experience)] <- "Not-Specified"
df_sub$required_education[is.na(df_sub$required_education)] <- "Not-Specified"
df_sub$sub_industry[is.na(df_sub$sub_industry)] <- "Not-Specified"
df_sub$industry[is.na(df_sub$industry)] <- "Not-Specified"
```

## Further modifications

```{r}
df_sub$location <- sub(",.*", "", df$location)
```

## Constructing a Job Text column

```{r}
df_sub$text <- paste(df_sub$title, df_sub$location, df_sub$company_profile,
                     df_sub$description, df_sub$requirements, sep = " ")
```

## Dropping the unwanted columns

```{r}
df_sub <- subset(df_sub,
                 select = -c(title, location, company_profile, description,
                             requirements))
```

## Building a corpus from the Text column

```{r}
data_corpus <- Corpus(VectorSource(df_sub$text))
data_corpus <- tm_map(data_corpus, removePunctuation)
data_corpus <- tm_map(data_corpus, removeWords, stopwords(kind = "en"))
data_corpus <- tm_map(data_corpus, stripWhitespace)
data_corpus <- tm_map(data_corpus, stemDocument)
```

### Checking the word frequencies

```{r}
frequencies <- DocumentTermMatrix(data_corpus)
```

```{r}
sparse_data <- removeSparseTerms(frequencies, 0.995)
sparse_data_df <- as.data.frame(as.matrix(sparse_data))
colnames(sparse_data_df) <- make.names(colnames(sparse_data_df))
sparse_data_df$fraudulent <- df_sub$fraudulent
```

## Adding features

```{r}
sparse_data_df <- cbind(df_sub$benefits, df_sub$telecommuting,
                       df_sub$has_company_logo, df_sub$has_questions,
                       sparse_data_df)

colnames(sparse_data_df)[1:4] <- c("benefits", "telecommuting",
                                   "has_company_logo", "has_questions")
```

```{r}
names(sparse_data_df) <- gsub("\\.$", "", names(sparse_data_df))
```

```{r}
basic_logit <- glm("fraudulent ~ has_company_logo + has_questions + 
                   benefits + multitask + customer*services",
                   data = sparse_data_df,
                   family = "binomial")
summary(basic_logit)
```

